

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. 超级链测试环境使用指南 &mdash; xuperchain-doc  文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/stat.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="1. 操作指导" href="../operations_guides.html" />
    <link rel="prev" title="1. 超级链测试环境说明" href="description.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> xuperchain-doc
          

          
          </a>

          
            
            
              <div class="version">
                3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">XuperChain介绍:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction/brief.html">1. 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/modules.html">2. 模块</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/datastruct.html">3. 核心数据结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/smart_contracts.html">4. 智能合约</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/permission_system.html">5. 权限系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/privacy.html">6. 隐私和保密</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/perfomance.html">7. 性能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/summary.html">8. 总结</a></li>
</ul>
<p class="caption"><span class="caption-text">快速入门</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">1. XuperChain环境部署</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html#basic-operation">2. XuperChain基本操作</a></li>
</ul>
<p class="caption"><span class="caption-text">技术设计文档:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/XuperModel.html">1. XuperModel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/XuperBridge.html">2. XuperBridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/xvm.html">3. XVM虚拟机</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/permission_model.html">4. 账号权限控制模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/p2p.html">5. 超级链p2p网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/authentication.html">6. 身份认证</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/proposal.html">7. 提案和投票机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/crypto.html">8. 密码学和隐私保护</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/extension.html">9. 插件机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/consensus.html">10. 超级链共识框架</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/chained_bft.html">11. Chained-BFT共识公共组件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/xpos.html">12. XPoS共识</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/single_pow.html">13. Single及PoW共识</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/regulatory.html">14. 超级链监管机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/multidisk.html">15. 多盘散列</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/group.html">16. 平行链与群组</a></li>
</ul>
<p class="caption"><span class="caption-text">进阶使用</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage/contract_accounts.html">1. 合约账号</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage/multi-nodes.html">2. 多节点部署</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage/create_contracts.html">3. 创建合约</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage/initiate_proposals.html">4. 发起提案</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage/multi-disks.html">5. 配置变更</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage/parallel_chain.html">6. 使用平行链与群组</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage/subscribe.html">7. 使用事件订阅功能</a></li>
</ul>
<p class="caption"><span class="caption-text">开发应用</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developing_apps/eleccert.html">1. 电子存证合约</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing_apps/erc721.html">2. 数字资产交易</a></li>
</ul>
<p class="caption"><span class="caption-text">开发手册</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development_manuals/XuperCDT.html">1. 智能合约SDK使用说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development_manuals/XuperRPC.html">2. XuperChain RPC 接口使用说明</a></li>
</ul>
<p class="caption"><span class="caption-text">超级链测试环境</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="description.html">1. 超级链测试环境说明</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. 超级链测试环境使用指南</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">2.1. 测试环境说明</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">2.2. 如何接入</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">2.3. 关于测试资源</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">2.4. 创建账号</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ak">2.4.1. 创建个人账号(AK)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#account">2.4.2. 创建合约账号(Account)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#acl">2.4.3. 设置合约账号ACL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id8">2.5. 合约操作</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">2.5.1. 合约编译</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">2.5.2. 合约账号充入测试资源</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">2.5.3. 合约部署</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">2.5.4. 合约调用</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">2.5.5. 设置合约接口ACL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#faq">2.6. FAQ</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">其他</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../operations_guides.html">1. 操作指导</a></li>
<li class="toctree-l1"><a class="reference internal" href="../video.html">2. 视频教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands_reference.html">3. 指令介绍(API)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQs.html">4. 常见问题解答</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vocabulary.html">5. 词汇表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lessons.html">6. 超级链小课堂</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">xuperchain-doc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>2. 超级链测试环境使用指南</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/test_network/guides.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>2. 超级链测试环境使用指南<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="section" id="id2">
<h2>2.1. 测试环境说明<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>在使用测试环境之前，请先点开 <a class="reference external" href="description.html">超级链测试环境说明</a> ，认真阅读超级链测试环境的目的、使用场景、用户使用条款。</p>
<p>如果您对测试环境说明中的内容有任何疑问，可以通过 <a class="reference external" href="http://xchain.baidu.com">xchain.baidu.com</a> 联系我们。如果您使用超级链测试环境，我们认为您已经明确并接受超级链测试环境说明中的相关内容和用户使用条款。</p>
</div>
<div class="section" id="id4">
<h2>2.2. 如何接入<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p>测试环境通过RPC方式提供服务，开发者可以在 <a class="reference external" href="https://github.com/xuperchain/xuperchain">github</a> 获取源代码，按照README说明编译得到cli客户端，当前测试环境使用v3.2分支。</p>
<ul class="simple">
<li>测试环境接入地址： <strong>14.215.179.74:37101</strong></li>
<li>黄反服务的address：  <strong>XDxkpQkfLwG6h56e896f3vBHhuN5g6M9u</strong></li>
</ul>
<p>开发者只需要在使用xchain-cli时，通过-H参数指定测试环境地址，即可将客户端命令发送到测试环境。 例如查询账号测试资源：</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli account balance dpzuVdosQrF2kmzumhVeFQZa1aYcdgFpN -H <span class="m">14</span>.215.179.74:37101
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id5">
<h2>2.3. 关于测试资源<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>测试环境上部署和执行智能合约需要消耗测试资源，测试环境目前尚未开放外部全节点P2P连接，且测试环境上节点出块并不会获得奖励，但出块节点会获得该块中所有Transaction中支付的测试资源。</p>
<p>目前获取测试资源主要有两种方式：</p>
<ol class="arabic simple">
<li>通过超级链公开网络渠道微信群、邮箱等等获取测试资质，可以免费获得测试资源。可以通过 <a class="reference external" href="https://github.com/xuperchain/xuperchain#%E8%81%94%E7%B3%BB%E6%88%91%E4%BB%AC">这里</a> 的微信二维码加入超级链用户微信群。</li>
<li>批量资源获取可邮件联系：<a class="reference external" href="http://xuper.baidu.com">xuper.baidu.com</a></li>
</ol>
</div>
<div class="section" id="id7">
<h2>2.4. 创建账号<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<div class="section" id="ak">
<h3>2.4.1. 创建个人账号(AK)<a class="headerlink" href="#ak" title="永久链接至标题">¶</a></h3>
<p>个人账号(AK)其实是一组公私钥对，个人帐号地址(address)是根据公钥经过一定规则导出的一个散列值。个人账号可以离线生成，不需要上链，只有在个人账号产生测试资源变动时(例如转入了一部分测试资源)才会在UTXO中产生记录。</p>
<p>在data/keys下会有一个默认的个人账号(AK)，包括address(你的地址)、private.key(你的私钥)、public.key(你的公钥)，建议按照如下命令重新生成一个独有的个人账号。</p>
<ul class="simple">
<li>指定私钥目录：在data/test_demo下生成address、private.key、public.key: ./xchain-cli account newkeys –output data/test_demo</li>
<li>覆盖默认目录： 覆盖data/keys下的文件，需要先删除data/keys目录，然后重新生成新的address、private.key、public.key</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>rm -r data/keys
./xchain-cli account newkeys
</pre></div>
</td></tr></table></div>
<p>个人账号地址默认在data/keys/address文件中，可通过cat data/keys/address 查看自己的个人账号地址。</p>
</div>
<div class="section" id="account">
<h3>2.4.2. 创建合约账号(Account)<a class="headerlink" href="#account" title="永久链接至标题">¶</a></h3>
<p>合约账号可以用来部署智能合约，创建合约账号是一个上链操作，因此也需要消耗一定量的测试资源。合约账号可以设置为多个个人账号共同持有，只有一个交易中的背书签名满足一定合约账号的ACL要求，才能代表这个合约账号进行操作。关于合约账号和ACL权限相关的内容，可以参考</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">创建合约账号需要向黄反服务拿一个签名，对应地，需要将黄反服务的address写到 data/acl/addrs 中，需要注意的是，multisig最终合入签名时需要将签名顺序与 data/acl/addrs 里面的地址顺序保持一致，否则会签名校验失败。</p>
</div>
<ul class="simple">
<li>Step0: 创建合约账号是一个系统合约，可以通过多重签名的方式发起系统合约调用。系统合约调用需要先创建一个合约调用描述文件，例如下面newAccount.json是一个创建合约账号的描述文件。 newAccount.json文件内容：</li>
</ul>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;module_name&quot;</span><span class="p">:</span> <span class="s2">&quot;xkernel&quot;</span><span class="p">,</span>
    <span class="s2">&quot;method_name&quot;</span><span class="p">:</span> <span class="s2">&quot;NewAccount&quot;</span><span class="p">,</span>
    <span class="s2">&quot;args&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;account_name&quot;</span><span class="p">:</span> <span class="s2">&quot;1234098776890654&quot;</span><span class="p">,</span>  <span class="c1"># 说明：16位数字组成的字符串</span>
        <span class="s2">&quot;acl&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">pm</span><span class="se">\&quot;</span><span class="s2">: {</span><span class="se">\&quot;</span><span class="s2">rule</span><span class="se">\&quot;</span><span class="s2">: 1,</span><span class="se">\&quot;</span><span class="s2">acceptValue</span><span class="se">\&quot;</span><span class="s2">: 1},</span><span class="se">\&quot;</span><span class="s2">aksWeight</span><span class="se">\&quot;</span><span class="s2">: {</span><span class="se">\&quot;</span><span class="s2">dpzuVdosQrF2kmzumhVeFQZa1aYcdgFpN</span><span class="se">\&quot;</span><span class="s2">: 1}}&quot;</span>  <span class="c1"># 这里的address改成自己的address</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step1: 多重签名需要收集多个账号的签名，在测试环境中主要是需要交易发起者以及黄反服务的签名，因此修改data/acl/addrs文件，将需要收集签名的address写入该文件中。以创建合约账号为例，需要黄反服务背书，因此在该文件中写入黄反服务address。</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>XDxkpQkfLwG6h56e896f3vBHhuN5g6M9u
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step2: 生成创建合约账号的原始交易，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig gen --desc newAccount.json -H <span class="m">14</span>.215.179.74:37101 --fee <span class="m">1000</span> --output rawTx.out
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step3: 向黄反服务获取签名，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig get --tx ./rawTx.out --host <span class="m">14</span>.215.179.74:37101 --output complianceCheck.out
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step4: 自己对原始交易签名，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig sign --tx ./rawTx.out --output my.sign
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step5: 将原始交易以及签名发送出去，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig send my.sign complianceCheck.out --tx ./rawTx.out -H <span class="m">14</span>.215.179.74:37101
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">Step5</span></code> 中放签名的地方：第一个my.sign签名对应的是交易发起者(Initiator)，第二个complianceCheck.out签名对应的是需要背书(AuthRequire)的地址，发起者签名和背书签名用空格分开，如果需要多个账号背书，那么多个背书签名用,隔开，且签名顺序需要与data/acl/addrs中的地址顺序一致。</p>
</div>
<p>创建成功后，你可以通过这个命令去查看你刚才创建的合约账号：</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli account query --host <span class="m">14</span>.215.179.74:37101
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="acl">
<h3>2.4.3. 设置合约账号ACL<a class="headerlink" href="#acl" title="永久链接至标题">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">前置条件：将合约账号以及合约账号下的有权限的AK以合约账号/address形式以追加方式存放到data/acl/addrs</p>
</div>
<ul class="simple">
<li>Step1: 生成设置合约账号的原始交易，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig gen --desc accountAclSet.json -H <span class="m">14</span>.215.179.74:37101 --fee <span class="m">10</span> --output rawTx.out
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step2: 向黄反服务获取签名，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig get --tx ./rawTx.out --host <span class="m">14</span>.215.179.74:37101 --output complianceCheck.out
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step3: 自己对原始交易签名，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig sign --tx ./rawTx.out --output my.sign
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step4: 将原始交易以及签名发送出去，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig send my.sign complianceCheck.out,my.sign --tx ./rawTx.out -H <span class="m">14</span>.215.179.74:37101
</pre></div>
</td></tr></table></div>
<p>accountAclSet.json模版如下：</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;module_name&quot;</span><span class="p">:</span> <span class="s2">&quot;xkernel&quot;</span><span class="p">,</span>
    <span class="s2">&quot;method_name&quot;</span><span class="p">:</span> <span class="s2">&quot;SetAccountAcl&quot;</span><span class="p">,</span>
    <span class="s2">&quot;args&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;account_name&quot;</span><span class="p">:</span> <span class="s2">&quot;XC1234098776890654@xuper&quot;</span><span class="p">,</span>
        <span class="s2">&quot;acl&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">pm</span><span class="se">\&quot;</span><span class="s2">: {</span><span class="se">\&quot;</span><span class="s2">rule</span><span class="se">\&quot;</span><span class="s2">: 1,</span><span class="se">\&quot;</span><span class="s2">acceptValue</span><span class="se">\&quot;</span><span class="s2">: 1},</span><span class="se">\&quot;</span><span class="s2">aksWeight</span><span class="se">\&quot;</span><span class="s2">: {</span><span class="se">\&quot;</span><span class="s2">ak1</span><span class="se">\&quot;</span><span class="s2">: 1}}&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id8">
<h2>2.5. 合约操作<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">合约操作包括编译、部署、调用、设置合约接口权限，目前XuperChain支持的合约语言包括C++，Go，我们以C++中的counter.cc为例，以此说明合约相关操作。</p>
</div>
<div class="section" id="id9">
<h3>2.5.1. 合约编译<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">合约编译是指将合约编译成二进制形式</p>
</div>
<p>例子：C++版本的counter.cc，counter.cc存放路径为contractsdk/cpp/example 预置条件：安装docker</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">cd</span> contractsdk/cpp
sh build.sh
</pre></div>
</td></tr></table></div>
<p>到当前目录build里，将编译好的合约二进制counter.wasm，重新命名为counter，放到某个目录下，比如笔者的目录是./output/</p>
</div>
<div class="section" id="id10">
<h3>2.5.2. 合约账号充入测试资源<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<p>合约部署需要合约账号才能操作，因此会消耗合约账号的测试资源，需要开发者先将个人账号的测试资源转一部分给合约账号。(注意，目前不支持合约账号的测试资源再转出给个人账号，因此请按需充入测试资源。)</p>
<ul class="simple">
<li>Step1: 生成测试资源转给合约账号的原始交易数据，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig gen --to XC1234098776890651@xuper --amount <span class="m">150000</span> --output rawTx.out --host <span class="m">14</span>.215.179.74:37101
</pre></div>
</td></tr></table></div>
<p>其中: –amount是转出的测试资源数量，–to是接收测试资源的账号名。如果转出方不是./data/keys下的默认地址，则可以使用–from指定转账来源账号，并将该来源地址的签名在multisig send时写在Initiator的位置。</p>
<ul class="simple">
<li>Step2: 向黄反服务获取签名，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig get --tx ./rawTx.out --output complianceCheck.out --host <span class="m">14</span>.215.179.74:37101
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step3: 自己对原始交易签名，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig sign --tx ./rawTx.out --output my.sign
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step4: 将原始交易以及签名发送出去，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig send my.sign complianceCheck.out --tx ./rawTx.out -H <span class="m">14</span>.215.179.74:37101
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step5: 查询合约账号的测试资源数额，确定转账成功：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli account balance XC1234098776890651@xuper -H <span class="m">14</span>.215.179.74:37101
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id11">
<h3>2.5.3. 合约部署<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">部署合约的前提条件是先创建一个合约账号，假设按照上述步骤已经创建了一个合约账号 <code class="docutils literal notranslate"><span class="pre">XC1234098776890651&#64;xuper</span></code> ，并且对应的合约账号有充裕的测试资源 前置条件：将合约账号以及合约账号下的有权限的AK以 <strong>合约账号/address</strong> 形式以追加方式存放到 data/acl/addrs</p>
</div>
<ul class="simple">
<li>Step0: 合约部署需要在交易中写入满足合约账号ACL的背书AK签名，为了表示某个AK在代表某个账号背书，超级链中定义了一种AK URI，例如 <em>dpzuVdosQrF2kmzumhVeFQZa1aYcdgFpN</em> 代表 <em>XC1234098776890651&#64;xuper</em> 这个合约账号，那么这个背书AK的AK URI可以写成：<strong>XC1234098776890651&#64;xuper/dpzuVdosQrF2kmzumhVeFQZa1aYcdgFpN</strong> 。</li>
</ul>
<p>以此为例，背书AK URI需要同时包含黄反服务和合约账号，因此需要将 data/acl/addrs 文件改成：</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>XDxkpQkfLwG6h56e896f3vBHhuN5g6M9u
XC1234098776890651@xuper/dpzuVdosQrF2kmzumhVeFQZa1aYcdgFpN
</pre></div>
</td></tr></table></div>
<p>Step1: 生成部署合约的原始交易，命令如下：</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli wasm deploy --account XC1234098776890651@xuper --cname counter -H <span class="m">14</span>.215.179.74:37101 -m ./counter --arg <span class="s1">&#39;{&quot;creator&quot;:&quot;xchain&quot;}&#39;</span> --output contractRawTx.out --fee <span class="m">137493</span>
</pre></div>
</td></tr></table></div>
<p>Step2: 向黄反服务获取签名，命令如下：</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig get --tx ./contractRawTx.out --host <span class="m">14</span>.215.179.74:37101 --output complianceCheck.out
</pre></div>
</td></tr></table></div>
<p>Step3: 自己对原始交易签名，命令如下：</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig sign --tx ./contractRawTx.out --output my.sign
</pre></div>
</td></tr></table></div>
<p>Step4: 将原始交易以及签名发送出去，命令如下：</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig send my.sign complianceCheck.out,my.sign --tx ./contractRawTx.out -H <span class="m">14</span>.215.179.74:37101
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id12">
<h3>2.5.4. 合约调用<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h3>
<p>编译合约，部署合约的目的都是为了能够在区块链系统上运行智能合约，本小节说明如下调用合约。</p>
<ul class="simple">
<li>Step1: 生成合约调用的原始交易，命令有下面两种实现方式：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig gen --desc counterIncrease.json -H <span class="m">14</span>.215.179.74:37101 --fee <span class="m">85</span> --output rawTx.out
<span class="c1"># 或者这样</span>
./xchain-cli wasm invoke -a <span class="s1">&#39;{&quot;key&quot;:&quot;counter&quot;}&#39;</span> --method increase counter -H <span class="m">14</span>.215.179.74:37101 --fee <span class="m">85</span> -m --output rawTx.out
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step2: 向黄反服务获取签名，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig get --tx ./rawTx.out --host <span class="m">14</span>.215.179.74:37101 --output complianceCheck.out
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step3: 自己对原始交易签名，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig sign --tx ./rawTx.out --output my.sign
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step4: 将原始交易以及签名发送出去，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig send my.sign complianceCheck.out --tx ./rawTx.out -H <span class="m">14</span>.215.179.74:37101
</pre></div>
</td></tr></table></div>
<p>counterIncrese.json模板，如下：</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;module_name&quot;</span><span class="p">:</span> <span class="s2">&quot;wasm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;contract_name&quot;</span><span class="p">:</span> <span class="s2">&quot;counter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;method_name&quot;</span><span class="p">:</span> <span class="s2">&quot;increase&quot;</span><span class="p">,</span>
    <span class="s2">&quot;args&quot;</span><span class="p">:{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;counter&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id13">
<h3>2.5.5. 设置合约接口ACL<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<div class="last line-block">
<div class="line">有这么一种场景：合约账号A部署了counter合约，希望只有拿到特定签名的用户才能调用counter的increase方法，因此XuperChain提供对智能合约某个方法进行权限设置</div>
<div class="line">前置条件：将合约账号以及合约账号下的有权限的AK以合约账号/address形式以追加方式存放到 data/acl/addrs</div>
</div>
</div>
<ul class="simple">
<li>Step1: 生成设置合约方法权限(ACL)的原始交易，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig gen --desc methodAclSet.json -H <span class="m">14</span>.215.179.74:37101 --fee <span class="m">10</span> --output rawTx.out
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step2: 向黄反服务获取签名，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig get --tx ./rawTx.out --host <span class="m">14</span>.215.179.74:37101 --output complianceCheck.out
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step3: 自己对原始交易签名，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig sign --tx ./rawTx.out --output my.sign
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step4: 将原始交易以及签名发送出去，命令如下：</li>
</ul>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./xchain-cli multisig send my.sign complianceCheck.out,my.sign --tx ./rawTx.out -H <span class="m">14</span>.215.179.74:37101
</pre></div>
</td></tr></table></div>
<p>methodAclSet.json的模版，如下：</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;module_name&quot;</span><span class="p">:</span> <span class="s2">&quot;xkernel&quot;</span><span class="p">,</span>
    <span class="s2">&quot;method_name&quot;</span><span class="p">:</span> <span class="s2">&quot;SetMethodAcl&quot;</span><span class="p">,</span>
    <span class="s2">&quot;args&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;contract_name&quot;</span><span class="p">:</span> <span class="s2">&quot;counter&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method_name&quot;</span><span class="p">:</span> <span class="s2">&quot;increase&quot;</span><span class="p">,</span>
        <span class="s2">&quot;acl&quot;</span><span class="p">:</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">pm</span><span class="se">\&quot;</span><span class="s2">: {</span><span class="se">\&quot;</span><span class="s2">rule</span><span class="se">\&quot;</span><span class="s2">: 1,</span><span class="se">\&quot;</span><span class="s2">acceptValue</span><span class="se">\&quot;</span><span class="s2">: 1},</span><span class="se">\&quot;</span><span class="s2">aksWeight</span><span class="se">\&quot;</span><span class="s2">: {</span><span class="se">\&quot;</span><span class="s2">TqnHT6QQnD9rjvqRJehEaAUB3ZwzSFZhR</span><span class="se">\&quot;</span><span class="s2">: 1}}&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="faq">
<h2>2.6. FAQ<a class="headerlink" href="#faq" title="永久链接至标题">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">为什么测试环境现在不开放全节点P2P账本同步？</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">目前超级链仍然处于高速迭代期，为了保证bug能够得到即时修复更新，我们暂时未开放外部P2P节点加入测试环境的功能，但用户通过GRPC接口已经能体验到测试环境的大部分功能。 当然，我们会在测试环境运行一段时间后，开放P2P节点加入乃至开放外部节点成为超级节点，具体时间目前还没有确定，请大家继续关注。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">测试环境中的测试资源可以转给别的个人账号吗？</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">不能，测试资源仅供在测试环境上进行超级链体验、智能合约开发测试使用，用户可以通过加入测试计划免费获得，用户获得的测试资源无法转给其他任何个人账号。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">测试环境为什么所有交易都需要黄反服务签名？</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">超级链测试环境上的数据是所有用户透明可见的，为了保证所有用户的体验，我们会对每个transaction中的数据进行合规性检测，尽量避免涉嫌黄反内容上链。用户违规发起涉嫌黄反内容的transaction引起的任何后果，都需要自行承担。请各位测试用户也从自身做起，保障一个干净和谐的网络环境。</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Q:</th><td class="field-body"><p class="first">编译cpp合约出现
<em>“Post http:///var/run/docker.sock/v1.19/containers/create: dial unix /var/run/docker.sock:
permission denied. Are you trying to connect to a TLS-enabled daemon without TLS?”</em>
是什么原因？</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">A:</th><td class="field-body"><p class="first">这可能是因为用户安装docker后，没有创建docker用户组，或者当前运行的系统账号不在docker用户组中，可以尝试下面的命令：</p>
<div class="last highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo groupadd docker
sudo usermod -aG docker <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>  // 此处<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>为你编译合约时使用的linux账号
service docker resteart
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../operations_guides.html" class="btn btn-neutral float-right" title="1. 操作指导" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="description.html" class="btn btn-neutral float-left" title="1. 超级链测试环境说明" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, xuper

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>